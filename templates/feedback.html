<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>{{ location.name }} - Geri Bildirim</title>
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1"
  >
  <!-- Bootstrap CSS (CDN) -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <style>
    body {
      background: #f8fafc;
    }

    .card {
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(20, 20, 40, 0.06);
    }

    .brand {
      font-weight: 600;
      letter-spacing: 0.2px;
    }

    .small-muted {
      color: #6b7280;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-light bg-white shadow-sm mb-3">
    <div class="container">
      <a
        class="navbar-brand brand"
        href="#"
      >{{ location.name }}</a>
    </div>
  </nav>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-6">
        <div class="card p-4 mb-3">
          <h5 class="mb-1">Bu alan için bildirimde bulun</h5>
          <p class="small-muted">Lütfen ilgili olan maddeleri işaretleyin. Gerekirse not ekleyin.</p>

          <form id="fbForm">
            <div class="mb-3">
              <!-- Checkbox list -->
              {% for opt in options %}
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="{{ opt.id }}"
                  id="opt_{{ opt.id }}"
                  name="issues"
                >
                <label
                  class="form-check-label"
                  for="opt_{{ opt.id }}"
                >
                  {{ opt.label }}
                </label>
              </div>
              {% endfor %}
            </div>

            <div class="mb-3">
              <label
                for="note"
                class="form-label"
              >Ek not (opsiyonel)</label>
              <textarea
                id="note"
                class="form-control"
                rows="3"
                placeholder="Örn: Lavabo tıkanmış gibi..."
              ></textarea>
            </div>

            <div class="d-grid">
              <button
                type="button"
                id="sendBtn"
                class="btn btn-primary btn-lg"
              >Bildirim Gönder</button>
            </div>

            <p
              id="msg"
              class="mt-3 text-success"
            ></p>
          </form>
        </div>

        <div class="text-center small-muted">
          <p>Teşekkür ederiz — bildiriminiz ilgili birime iletilecektir.</p>
          <p class="mb-0"><a
              href="{{ location.qr_url }}"
              target="_blank"
              class="small-muted"
            >Tekrar denemek için tıklayın</a></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('sendBtn').addEventListener('click', async function () {
      const checked = Array.from(document.querySelectorAll('input[name="issues"]:checked')).map(i => i.value);
      const note = document.getElementById('note').value.trim();
      if (checked.length === 0 && note.length === 0) {
        document.getElementById('msg').innerText = 'Lütfen en az bir seçenek işaretleyin veya not girin.';
        document.getElementById('msg').style.color = 'red';
        return;
      }
      document.getElementById('sendBtn').disabled = true;
      document.getElementById('msg').innerText = 'Gönderiliyor...';
      try {
        const res = await fetch('/api/feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ location_code: '{{ location.code }}', issues: checked, note: note })
        });
        const j = await res.json();
        if (j.ok) {
          document.getElementById('msg').innerText = 'Teşekkürler! Bildirim gönderildi.';
          document.getElementById('msg').style.color = 'green';
          // formu temizle
          document.querySelectorAll('input[name="issues"]').forEach(i => i.checked = false);
          document.getElementById('note').value = '';
        } else {
          document.getElementById('msg').innerText = 'Hata: ' + (j.error || 'Bilinmeyen');
          document.getElementById('msg').style.color = 'red';
        }
      } catch (e) {
        document.getElementById('msg').innerText = 'Ağ hatası, lütfen tekrar deneyin.';
        document.getElementById('msg').style.color = 'red';
      } finally {
        document.getElementById('sendBtn').disabled = false;
      }
    });
  </script>
</body>

</html>














<!-- ********* ONCEKI KOD ********* -->

<!-- <!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>{{ location.name }} - Geri Bildirim</title>
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1"
  >
</head>

<body style="font-family: Arial; padding:20px;">
  <h3>{{ location.name }}</h3>
  <p>Lütfen durumu seçin:</p>
  <div style="display:flex; gap:10px; margin-bottom: 12px;">
    {% for opt in options %}
    <button
      onclick="send('{{ opt }}')"
      style="padding:12px 18px; font-size:16px;"
    >{{ opt }}</button>
    {% endfor %}
  </div>
  <p
    id="msg"
    style="color:green"
  ></p>

  <script>
    function send(s) {
      document.getElementById('msg').innerText = 'Gönderiliyor...';
      fetch('/api/feedback', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ location_code: '{{ location.code }}', status: s })
      }).then(r => r.json()).then(j => {
        if (j.ok) document.getElementById('msg').innerText = 'Teşekkürler! Bildirim gönderildi.';
        else document.getElementById('msg').innerText = 'Hata: ' + (j.error || 'Bilinmeyen');
      }).catch(e => {
        document.getElementById('msg').innerText = 'Ağ hatası, tekrar deneyin.';
      });
    }
  </script>
</body>

</html> -->
<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>{{ location.name }} - Geri Bildirim</title>
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1"
  >
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap"
    rel="stylesheet"
  >
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(180deg, #f8fbff, #f6f9fe);
    }

    .card-soft {
      border-radius: 14px;
      box-shadow: 0 8px 28px rgba(20, 30, 80, 0.05);
    }

    .brand {
      color: #2b3a67;
      font-weight: 600;
    }

    .muted {
      color: #6b7280;
    }

    .btn-primary {
      background: linear-gradient(90deg, #6b8cf0, #7aa2ff);
      border: none;
    }

    .footer-note {
      font-size: .9rem;
      color: #94a3b8;
    }

    .hero {
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
    }

    .icon-circle {
      width: 64px;
      height: 64px;
      background: linear-gradient(180deg, #e8f0ff, #f1f7ff);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-light bg-transparent py-3">
    <div class="container">
      <a
        class="navbar-brand brand"
        href="#"
      >{{ location.name }}</a>
    </div>
  </nav>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-10 col-lg-7">
        <div class="card card-soft p-4">
          <div class="hero">
            <div class="icon-circle me-3">
              <!-- simple icon -->
              <svg
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 2L19 7V17L12 22L5 17V7L12 2Z"
                  stroke="#5B7CE8"
                  stroke-width="1.2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
            <div>
              <h5 class="mb-0">Bildirimi Hızlıca İlet</h5>
              <div class="muted">Lütfen aşağıdaki seçeneklerden uygun olanları seçin ve gönderin.</div>
            </div>
          </div>

          <form id="fbForm">
            <div class="mb-3">
              {% for opt in options %}
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="{{ opt.id }}"
                  id="opt_{{ opt.id }}"
                  name="issues"
                >
                <label
                  class="form-check-label"
                  for="opt_{{ opt.id }}"
                >
                  {{ opt.label }}
                </label>
              </div>
              {% endfor %}
            </div>

            <div class="mb-3">
              <label
                for="note"
                class="form-label"
              >Ek not (opsiyonel)</label>
              <textarea
                id="note"
                class="form-control"
                rows="3"
                placeholder="İstersen kısa bir açıklama yazabilirsin."
              ></textarea>
            </div>

            <div class="d-grid">
              <button
                type="button"
                id="sendBtn"
                class="btn btn-primary btn-lg"
              >Bildirim Gönder</button>
            </div>

            <p
              id="msg"
              class="mt-3"
            ></p>
          </form>

          <div class="mt-3 footer-note text-center">
            <div>Yardımcı olmak için teşekkürler — bildiriminiz ilgili personele iletilecektir.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('sendBtn').addEventListener('click', async function () {
      const checked = Array.from(document.querySelectorAll('input[name="issues"]:checked')).map(i => i.value);
      const note = document.getElementById('note').value.trim();
      const msgEl = document.getElementById('msg');
      if (checked.length === 0 && note.length === 0) {
        msgEl.innerText = 'Lütfen en az bir seçenek işaretleyin veya not girin.';
        msgEl.style.color = '#d9534f';
        return;
      }
      this.disabled = true;
      msgEl.innerText = 'Gönderiliyor...';
      msgEl.style.color = '#6b7280';
      try {
        const res = await fetch('/api/feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ location_code: '{{ location.code }}', issues: checked, note: note })
        });
        const j = await res.json();
        if (j.ok) {
          msgEl.innerText = 'Teşekkürler! Bildirim gönderildi.';
          msgEl.style.color = '#16a34a';
          document.querySelectorAll('input[name="issues"]').forEach(i => i.checked = false);
          document.getElementById('note').value = '';
        } else {
          msgEl.innerText = 'Hata: ' + (j.error || 'Bilinmeyen');
          msgEl.style.color = '#d9534f';
        }
      } catch (e) {
        msgEl.innerText = 'Ağ hatası, lütfen tekrar deneyin.';
        msgEl.style.color = '#d9534f';
      } finally {
        this.disabled = false;
      }
    });
  </script>
</body>

</html>